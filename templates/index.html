<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    <title>Reko</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
    <link href='https://fonts.googleapis.com/css?family=Londrina+Outline' rel='stylesheet' type='text/css'>
</head>

<body>
    <div class="logo">Reko.</div>
    <div class="navigation">
        <button class="btn btn-default next"><i class="fa fa-chevron-right" aria-hidden="true"></i> Next</button>
        <button class="btn btn-default like"><i class="fa fa-thumbs-o-up" aria-hidden="true"></i> Like</button>
        <button onclick="location.href = '/about'" class="btn btn-default about"><i class="fa fa-info" aria-hidden="true"></i> About</button>
    </div>
    <div class="container">
        <div class="row">
            <div class="link">Link</div>
            <div class="col-md-8 col-md-offset-2" id="url"></div>
        </div>
        <div class="row">
            <div class="col-md-8 col-md-offset-2" id="embed"></div>
        </div>   
    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<script>
    var token = $.cookie("token");
    var nsfw = false;
    var _id;
    if (!token) {
        $.post("/authenticate", {}).done(function(response) {
            token = response;
            $.cookie("token", token);
            getter()
        })
    }
    else{
        getter()
    }
    function getter() {
        $.get("next", {
            token: token,
            nsfw: nsfw
        }, function (response) {
            _id = response.article._id;
            if (response.article.content.startsWith("http")) {
                $("#embed").html("<img height=80% src=" + response.article.content + "></img>");
            }
            else {
                $("#embed").html(response.article.content);
            }
            $("#url").html('<a href="' + response.article.url + '">' + response.article.url + '</a>')
        }).fail(function (response) {
            if (response.status == 403){
            $.removeCookie("token")
        }})
    }

    var like = function(){
     var data = JSON.stringify({url: _id});
     $.ajax({type: 'POST',
             url: '/like?token=' + token,
             data: data,
             contentType: "application/json",
             dataType: "application/json",
             complete: function (response) {
                getter()
            }
            });

    }
    $(".like").on("click", function(){like()});
    $(".next").on("click", function(){
        getter()
    });
    $(document).keydown(function(e) {
        switch(e.which) {
            case 37: // left
                getter()
                break;
            case 39: // right
                like();
        }})

</script>
</body>
</html>